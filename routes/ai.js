const express = require('express'); const router = express.Router(); const openai = require('openai'); const client = new openai.OpenAI({ apiKey: process.env.OPENAI_KEY }); router.post('/plexa', async (req, res) => { const { prompt } = req.body; if (!prompt) return res.status(400).json({ error: 'No prompt' }); if (!process.env.OPENAI_KEY) return res.status(500).json({ error: 'No AI key' }); try { const completion = await client.chat.completions.create({ model: 'gpt-4o-mini', messages: [{ role: 'system', content: 'You are Plexa, an assistant for Echoplex users. You are friendly, concise, and helpful.' }, { role: 'user', content: prompt }], max_tokens: 600 }); const assistantReply = completion.choices?.[0]?.message?.content || 'No response'; const isSafe = true; if (!isSafe) return res.status(403).json({ reply: 'I cannot respond to this topic.' }); 
res.json({ reply: assistantReply }); } catch (err) { console.error(err.response?.data || err.message); res.status(500).json({ error: 'AI error' }); } }); module.exports = router;